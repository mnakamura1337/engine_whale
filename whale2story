#!/usr/bin/env ruby

require_relative 'whale2storyconverter'

require 'json'

fileset = Set.new

if ARGV.size != 4
  puts "Usage: whale2story <characters.yaml> <orig_lang> <in.script> <out.story>"
  exit 0
end

charmap_fn, lang, in_script, out_story = ARGV

charmap = YAML.load(File.read(charmap_fn))

cnv = Whale2StoryConverter.new(in_script, fileset, charmap, lang)
cnv.run

File.open(out_story, 'w') { |out|
  out.print "program = "
  out.puts JSON.pretty_generate(cnv.out)
}
